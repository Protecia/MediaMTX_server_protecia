services:

  mediamtx-re7:
    image: rg.fr-par.scw.cloud/protecia/mediamtx:${IMAGE_TAG}
    container_name: mediamtx-re7
    restart: unless-stopped
    environment:
      - MTX_RTSPTRANSPORTS=tcp
      - MTX_WEBRTCADDITIONALHOSTS=mtx-re7.protecia.net
      - MEDIA_MTX_API_PASS=${MTX_ADMIN_PASS}
    volumes:
      - /home/protecia/deploy/mediamtx-re7.yaml:/mediamtx.yml
    labels:
      # RTSP
      - "traefik.tcp.services.mediamtx-rtsp.loadbalancer.server.port=8554"
      - "traefik.tcp.routers.mediamtx-rtsp.rule=HostSNI(`*`)"
      - "traefik.tcp.routers.mediamtx-rtsp.entrypoints=rtsp"
      - "traefik.tcp.routers.mediamtx-rtsp.tls=true"
      - "traefik.tcp.routers.mediamtx-rtsp.tls.certresolver=myresolver"
      # WEBRTC
      - "traefik.http.services.mediamtx.loadbalancer.server.port=8889"
      - "traefik.http.routers.mediamtx.entrypoints=webrtc"
      - "traefik.http.routers.mediamtx.tls=true"
      - "traefik.http.routers.mediamtx.tls.certresolver=myresolver"
      - "traefik.http.routers.mediamtx.rule=Host(`mtx-re7.protecia.net`)"
      - "traefik.docker.network=network_protecia_re7"
    ports:
      - "8554:8554"       # RTSP
      - "8189:8189/udp"   # WEB RTC
    networks:
      network_protecia_re7:


networks:
  network_protecia_re7:
    external: true
